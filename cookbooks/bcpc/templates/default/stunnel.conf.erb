;###############################################
;
;              Generated by Chef
;
;###############################################

; *****************************************************************************
; * Global Options                                                            *
; *****************************************************************************

chroot = /var/lib/stunnel4/
setuid = stunnel4
setgid = stunnel4
pid = /stunnel4.pid
debug = 4
output = /var/log/stunnel4/stunnel.log

; *****************************************************************************
; * Service Defaults (may also be specified in individual service sections)   *
; *****************************************************************************

client = no
verify = 1
cert = /etc/ssl/certs/ssl-bcpc.pem
key = /etc/ssl/private/ssl-bcpc.key
CAfile = /etc/ssl/certs/ssl-bcpc.pem

options = NO_SSLv2
options = SINGLE_ECDH_USE
options = SINGLE_DH_USE

ciphers = ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-CAMELLIA256-SHA
options = CIPHER_SERVER_PREFERENCE

; *****************************************************************************
; * Service Definitions (remove all services for inetd mode)                  *
; *****************************************************************************

; Example SSL server mode services

<% if node['bcpc']['protocol']['keystone'] == 'https' -%>
[keystone]
accept  = <%=node['bcpc']['management']['ip']%>:5000
connect = 127.0.0.1:5000

[keystone-admin]
accept  = <%=node['bcpc']['management']['ip']%>:35357
connect = 127.0.0.1:35357
<% end -%>

<% if node['bcpc']['protocol']['nova'] == 'https' -%>
[nova-api]
accept  = <%=node['bcpc']['management']['ip']%>:8774
connect = 127.0.0.1:8774

[nova-ec2]
accept  = <%=node['bcpc']['management']['ip']%>:8773
connect = 127.0.0.1:8773
<% end -%>

<% if node['bcpc']['protocol']['cinder'] == 'https' -%>
[cinder-api]
accept  = <%=node['bcpc']['management']['ip']%>:8776
connect = 127.0.0.1:8776
<% end -%>

<% if node['bcpc']['protocol']['glance'] == 'https' -%>
[glance-api]
accept  = <%=node['bcpc']['management']['ip']%>:9292
connect = 127.0.0.1:9292

[glance-registry]
accept  = <%=node['bcpc']['management']['ip']%>:9191
connect = 127.0.0.1:9191
<% end -%>

<% if node['bcpc']['protocol']['neutron'] == 'https' -%>
[neutron-api]
accept  = <%=node['bcpc']['management']['ip']%>:9696
connect = 127.0.0.1:9696
<% end -%>

<% if node['bcpc']['protocol']['heat'] == 'https' -%>
[heat-api]
accept  = <%=node['bcpc']['management']['ip']%>:8004
connect = 127.0.0.1:8004

[heat-api-cfn]
accept  = <%=node['bcpc']['management']['ip']%>:8000
connect = 127.0.0.1:8000
<% end -%>
